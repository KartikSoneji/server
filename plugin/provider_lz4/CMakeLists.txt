CHECK_INCLUDE_FILES(lz4.h HAVE_LZ4_H)
CHECK_LIBRARY_EXISTS(lz4 LZ4_compress_default "" HAVE_LZ4_COMPRESS_DEFAULT)

IF (HAVE_LZ4_H AND HAVE_LZ4_COMPRESS_DEFAULT)
  GET_PROPERTY(dirs DIRECTORY PROPERTY INCLUDE_DIRECTORIES)
  LIST(REMOVE_ITEM dirs ${CMAKE_SOURCE_DIR}/include/wrappers)
  SET_PROPERTY(DIRECTORY PROPERTY INCLUDE_DIRECTORIES "${dirs}")

  MYSQL_ADD_PLUGIN(provider_lz4 plugin.c MODULE_OUTPUT_NAME provider_lz4
    COMPONENT provider_lz4 LINK_LIBRARIES lz4 CONFIG provider_lz4.cnf)
ENDIF()
